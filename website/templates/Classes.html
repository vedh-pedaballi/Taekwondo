{% extends "base.html" %}

{% block title %}Classes - Tornado Sports Club{% endblock %}

{% block content %}
<div class="hero-section classes-hero">
    <div class="hero-content">
        <h1>Our Classes</h1>
        <p>Discover the perfect program for your athletic journey</p>
    </div>
</div>

<div class="section schedule-section">
    <h2>This Week's Class Schedule</h2>
    <div class="schedule-grid">
        {% for day in days_of_week %}
        <div class="schedule-day">
            <h3>{{ day }}</h3>
            {% if day in weekly_schedule %}
                {% for event in weekly_schedule[day] %}
                <div class="schedule-item">
                    <span class="time">{{ event.date.strftime('%I:%M %p') }}</span>
                    <span class="class-name">{{ event.title }}</span>
                    {% if event.description %}
                    <span class="class-description">{{ event.description }}</span>
                    {% endif %}
                </div>
                {% endfor %}
            {% else %}
                <div class="schedule-item no-classes">
                    <span class="class-name">No classes scheduled</span>
                </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
</div>

<div class="section calendar-section">
    <h2>Live Class Calendar</h2>
    <div class="calendar-container">
        <div class="calendar-info">
            <p>View our real-time class schedule and book your sessions directly through Google Calendar.</p>
            <div class="calendar-actions">
                <a href="https://calendar.google.com/calendar/embed?src=tornadoclasstimes%40gmail.com" target="_blank" class="button">Open in Google Calendar</a>
                <a href="https://calendar.google.com/calendar/ical/tornadoclasstimes%40gmail.com/public/basic.ics" class="button secondary">Subscribe to Calendar</a>
            </div>
        </div>
        <div class="google-calendar-embed" id="calendar-container">
            <iframe 
                id="calendar-iframe"
                src="https://calendar.google.com/calendar/embed?src=tornadoclasstimes%40gmail.com&ctz=America%2FNew_York&mode=WEEK&showTitle=0&showNav=1&showDate=1&showPrint=0&showTabs=1&showCalendars=0&showTz=0&wkst=1&bgcolor=%23ffffff&color=%23000000" 
                style="border: 0" 
                width="100%" 
                height="600" 
                frameborder="0" 
                scrolling="yes">
            </iframe>
        </div>
    </div>
</div>

<!-- Calender cards section -->
<div class="section upcoming-events-section">
    <h2>Upcoming Events</h2>
    <div class="events-grid">
        {% for event in events %}
        <div class="event-card">
            <div class="event-date">
                <div class="day">{{ event.date.split('-')[2] }}</div>
                <div class="month">{{ event.date.split('-')[1] }}</div>
            </div>
            <div class="event-content">
                <h3>{{ event.title }}</h3>
                <div class="event-details">
                    <p><i class="far fa-clock"></i> {{ event.time }}</p>
                    <p><i class="far fa-calendar"></i> {{ event.date }}</p>
                </div>
                <!-- can take this out, no need for description -->
                <p class="event-description">{{ event.description }}</p>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<div class="section pricing-section">
    <h2>Membership Options</h2>
    <div class="pricing-grid">
        <div class="pricing-item">
            <h3>Basic</h3>
            <div class="price">$49/month</div>
            <ul>
                <li>Access to 2 classes per week</li>
                <li>Basic equipment access</li>
                <li>Locker room access</li>
            </ul>
            <a href="{{ url_for('signup_page') }}" class="button">Choose Plan</a>
        </div>
        
        <div class="pricing-item featured">
            <h3>Premium</h3>
            <div class="price">$89/month</div>
            <ul>
                <li>Unlimited class access</li>
                <li>All equipment access</li>
                <li>Personal training sessions</li>
                <li>Competition entry fees</li>
            </ul>
            <a href="{{ url_for('signup_page') }}" class="button">Choose Plan</a>
        </div>
        
        <div class="pricing-item">
            <h3>Family</h3>
            <div class="price">$129/month</div>
            <ul>
                <li>Up to 4 family members</li>
                <li>Unlimited class access</li>
                <li>All equipment access</li>
                <li>Family discounts on events</li>
            </ul>
            <a href="{{ url_for('signup_page') }}" class="button">Choose Plan</a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const calendarIframe = document.getElementById('calendar-iframe');
    const calendarContainer = document.getElementById('calendar-container');
    
    if (calendarIframe) {
        // Function to attempt scrolling
        function attemptScroll() {
            console.log('Attempting to scroll calendar to bottom...');
            
            // Method 1: Try to access iframe content directly
            try {
                const iframeDoc = calendarIframe.contentDocument || calendarIframe.contentWindow.document;
                if (iframeDoc && iframeDoc.body) {
                    iframeDoc.body.scrollTop = iframeDoc.body.scrollHeight;
                    console.log('Successfully scrolled iframe content to bottom');
                    return true;
                }
            } catch (e) {
                console.log('Direct iframe access failed due to cross-origin restrictions');
            }
            
            // Method 2: Try to scroll the iframe element itself
            try {
                calendarIframe.scrollTop = calendarIframe.scrollHeight;
                console.log('Scrolled iframe element to bottom');
                return true;
            } catch (e) {
                console.log('Iframe element scroll failed');
            }
            
            // Method 3: Try to scroll the container
            try {
                calendarContainer.scrollTop = calendarContainer.scrollHeight;
                console.log('Scrolled calendar container to bottom');
                return true;
            } catch (e) {
                console.log('Container scroll failed');
            }
            
            return false;
        }
        
        // Try scrolling immediately when iframe loads
        calendarIframe.addEventListener('load', function() {
            console.log('Calendar iframe loaded');
            
            // Try multiple times with delays
            setTimeout(attemptScroll, 1000);
            setTimeout(attemptScroll, 2000);
            setTimeout(attemptScroll, 3000);
            setTimeout(attemptScroll, 5000);
        });
        
        // Also try on page load
        setTimeout(attemptScroll, 1000);
        setTimeout(attemptScroll, 3000);
    }
});
</script>
{% endblock %}